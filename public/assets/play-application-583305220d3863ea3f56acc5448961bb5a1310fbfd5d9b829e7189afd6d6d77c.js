Tectonic={handleError:function(t){console.log("error response is ",t),422==t.status?(alert("You cannot do that."),console.log("422 error")):(console.log("general error"),wanna_see=confirm("An Error Occurred: "+t.statusText),wanna_see&&alert(t.responseText))},getTimer:function(){return 3e3}},Avatar={load:function(t){t.each(function(){var t=$(this).find("span.owner"),n=$(this).attr("plate_id");Avatar.get(n,t)})},remove:function(t){t.each(function(){var t=$(this).find("span.owner");$(this).find("input").val();t.css("background-image",""),t.css("background-size",""),t.fadeOut("fast")})},get:function(t,n){$.ajax({type:"get",url:"/spoils/avatar/"+t}).success(function(t){n.css("background-image","url("+t+")"),n.css("background-size","36px"),n.css("background-color","#fff"),n.css("display","block"),n.css("border","thin solid #ccc"),n.fadeIn("slow",1)}).error(function(t){Tectonic.handleError(t)})},preload:function(t){t.each(function(){var t=$(this).find("span.owner");$(this).attr("plate_code");t.css("background-image","url(/img/preloader.gif)"),t.css("background-color",""),t.css("background-size","36px"),t.css("border","none"),t.css("opacity",".8"),t.css("display","block"),t.fadeIn("slow",1)})},preUnload:function(t){t.each(function(){var t=$(this).find("span.owner");$(this).attr("plate_code");t.css("background-image","none")})}},Table={join:function(t){if($("div.ranking[player_id='"+t.id+"']").length);else{var n=$("#rankings-container");html='<li><div class="row collapse ranking select-player" player_id="'+t.id+'"><div class="small-6 medium-4 columns player-image"><img class="icon player-icon player-image" width="64" src="'+t.image+'"></div><div class="small-6 columns medium-2 player-points right medium-text-right" player="'+t.first_name+" "+t.last_name+'">0</div><div class="small-12 medium-6 columns player-name hide-for-small-only" player="'+t.first_name+" "+t.last_name+'">'+t.first_name+"</div></div></li>",n.append(html)}},update_points:function(t,n){current_points=$("div.ranking[player_id='"+t.id+"']").find(".player-points").text(),current_team_points=$("div#team-points").text(),console.log("CURRENT TO POINTS from "+current_points+" points"),console.log("team to points"+current_team_points+" points"),null==n&&(n=0),Table.spin($("div.ranking[player_id='"+t.id+"']").find(".player-points"),current_points,n),Table.spin($("div#team-points"),current_team_points,n)},spin:function(t,n,e){if(n<e)var o="up";else var o="down";t.each(function(){var t=$(this);"up"==o?t.addClass("going-up"):t.addClass("going-down"),jQuery({Counter:n}).animate({Counter:e},{duration:2e3,easing:"swing",step:function(){t.text(Math.ceil(this.Counter))},complete:function(){Table.reorder()}})})},reorder:function(){var t=$("#rankings-container"),n=[];t.find(".ranking").each(function(){var t=$(this),e=t.attr("player_id"),o=parseFloat(t.find(".player-points").text());isNaN(o)||n.push([o,e,t.html()])}),n.sort(function(t,n){return n[0]-t[0]}),t.html("");for(var e=0,o=n.length;e<o;e++)t.append('<li><div class="row collapse ranking" player_id="'+n[e][1]+'">'+n[e][2]+"</div></li>");$(".going-up").removeClass("going-up"),$(".going-down").removeClass("going-down"),n=null}},Plate={disable:function(t){console.log("Disable Plate",t),t.addClass("processing"),Avatar.preload(t)},enable:function(t,n){t.removeClass("processing"),""!==n?(console.log("its a bonus"),$("#celebration").addClass(n),$("#celebration").addClass("fireworks")):console.log("not a bonus")},turnOn:function(t){t.fadeTo("slow",1),t.removeClass("visibilty-faded"),t.removeClass("found"),Avatar.remove(t)},turnOff:function(t){t.fadeTo("slow",.3),t.addClass("found"),t.addClass("visibilty-faded"),Avatar.load(t)}},$(document).ready(function(){function t(t,n,o){Plate.disable(o);var i={enableHighAccuracy:!0,timeout:5e3};navigator.geolocation.getCurrentPosition(function(i){({lat:i.coords.latitude,lng:i.coords.longitude});coord_as_string=i.coords.latitude+"|"+i.coords.longitude,e(t,n,o,coord_as_string)},function(){},i)}function n(t,n){$.ajax({type:"POST",url:"/spoils/lock",dataType:"JSON",data:{code:t}}).success(function(){}).error(function(t){Tectonic.handleError(t),n.find("span.owner").fadeOut(),n.css("border","none")})}function e(t,n,e,o){var i="/spoils/";console.log($(".active-player"),$(".active-player").attr("player_id")),$(".active-player").length&&(i="/spoils/"+$(".active-player").attr("player_id"));$.ajax({type:"POST",url:i,dataType:"JSON",data:{code:t,plate_id:n,current_location:o}}).success(function(){Plate.enable(e),Plate.turnOff(e)}).error(function(t){Plate.enable(e),Plate.turnOn(e),Tectonic.handleError(t)})}function o(t,n){if(console.log("remove spoil?"),confirm("Are you sure you wan to remove this amazing spoil?")){$.ajax({type:"POST",url:"/spoils/clear",dataType:"JSON",data:{code:t}}).success(function(){Plate.turnOn(n)}).error(function(t){Tectonic.handleError(t),Plate.turnOff(n)})}else console.log("false alarm")}function i(t){var n=$("#players").width();console.log(n),t.matches?($(document.body).hasClass("f-topbar-fixed"),n=$("#players").width(),$(window).scroll(function(){$(document.body).hasClass("f-topbar-fixed")?(console.log(n),$("#players").css("position","fixed"),$("#players").css("top","60px"),$("#players").css("width",n+20)):$(document.body).hasClass("f-topbar-fixed")||(console.log("remove fixed"),$("#players").css("position","relative"),$("#players").css("top",""),$("#players").removeClass("fixed-width"))})):$(window).scroll(function(){})}if($("#play").length>0&&(Avatar.load($(".plate.found")),$(document).on("click",".player-image",function(){console.log("selecting player "+$(this).closest(".select-player").attr("player_id")),$(this).closest(".select-player").hasClass("active-player")?$(this).closest(".select-player").removeClass("active-player"):($(".active-player").removeClass("active-player"),$(this).closest(".select-player").addClass("active-player"))}),$(".plate").on("click",function(){var e=$(this).attr("plate_code"),i=$(this).attr("plate_id");$(this).hasClass("found")?o(e,$(this)):(n(e,$(this)),t(e,i,$(this)))})),matchMedia){var s=window.matchMedia("(min-width: 640px)");s.addListener(i),i(s)}var s=window.matchMedia("(max-width: 640px)");s.matches&&$("#players").addClass("sticky")}),function(){var t=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},createConsumer:function(t){var n;return null==t&&(t=null!=(n=this.getConfig("url"))?n:this.INTERNAL.default_mount_path),new ActionCable.Consumer(this.createWebSocketURL(t))},getConfig:function(t){var n;return n=document.head.querySelector("meta[name='action-cable-"+t+"']"),null!=n?n.getAttribute("content"):void 0},createWebSocketURL:function(t){var n;return t&&!/^wss?:/i.test(t)?(n=document.createElement("a"),n.href=t,n.href=n.href,n.protocol=n.protocol.replace("http","ws"),n.href):t},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var n;if(n=1<=arguments.length?t.call(arguments,0):[],this.debugging)return n.push(Date.now()),console.log.apply(console,["[ActionCable]"].concat(t.call(n)))}},"undefined"!=typeof window&&null!==window&&(window.ActionCable=this.ActionCable),"undefined"!=typeof module&&null!==module&&(module.exports=this.ActionCable)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};ActionCable.ConnectionMonitor=function(){function n(n){this.connection=n,this.visibilityDidChange=t(this.visibilityDidChange,this),this.reconnectAttempts=0}var e,o,i;return n.pollInterval={min:3,max:30},n.staleThreshold=6,n.prototype.start=function(){if(!this.isRunning())return this.startedAt=o(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),ActionCable.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},n.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=o(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),ActionCable.log("ConnectionMonitor stopped")},n.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},n.prototype.recordPing=function(){return this.pingedAt=o()},n.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,ActionCable.log("ConnectionMonitor recorded connect")},n.prototype.recordDisconnect=function(){return this.disconnectedAt=o(),ActionCable.log("ConnectionMonitor recorded disconnect")},n.prototype.startPolling=function(){return this.stopPolling(),this.poll()},n.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},n.prototype.poll=function(){return this.pollTimeout=setTimeout(function(t){return function(){return t.reconnectIfStale(),t.poll()}}(this),this.getPollInterval())},n.prototype.getPollInterval=function(){var t,n,o,i;return i=this.constructor.pollInterval,o=i.min,n=i.max,t=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*e(t,o,n))},n.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return ActionCable.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+i(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?ActionCable.log("ConnectionMonitor skipping reopening recent disconnect"):(ActionCable.log("ConnectionMonitor reopening"),this.connection.reopen())},n.prototype.connectionIsStale=function(){var t;return i(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},n.prototype.disconnectedRecently=function(){return this.disconnectedAt&&i(this.disconnectedAt)<this.constructor.staleThreshold},n.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout(function(t){return function(){if(t.connectionIsStale()||!t.connection.isOpen())return ActionCable.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),t.connection.reopen()}}(this),200)},o=function(){return(new Date).getTime()},i=function(t){return(o()-t)/1e3},e=function(t,n,e){return Math.max(n,Math.min(e,t))},n}()}.call(this),function(){var t,n,e,o,i,s,r=[].slice,c=function(t,n){return function(){return t.apply(n,arguments)}},a=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};o=ActionCable.INTERNAL,n=o.message_types,e=o.protocols,i=2<=e.length?r.call(e,0,t=e.length-1):(t=0,[]),s=e[t++],ActionCable.Connection=function(){function t(t){this.consumer=t,this.open=c(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new ActionCable.ConnectionMonitor(this),this.disconnected=!0}return t.reopenDelay=500,t.prototype.send=function(t){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(t)),!0)},t.prototype.open=function(){if(this.isActive())throw ActionCable.log("Attempted to open WebSocket, but existing socket is "+this.getState()),new Error("Existing connection must be closed before opening");return ActionCable.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+e),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new WebSocket(this.consumer.url,e),this.installEventHandlers(),this.monitor.start(),!0},t.prototype.close=function(t){var n,e;if(n=(null!=t?t:{allowReconnect:!0}).allowReconnect,n||this.monitor.stop(),this.isActive())return null!=(e=this.webSocket)?e.close():void 0},t.prototype.reopen=function(){var t;if(ActionCable.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(n){return t=n,ActionCable.log("Failed to reopen WebSocket",t)}finally{ActionCable.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},t.prototype.getProtocol=function(){var t;return null!=(t=this.webSocket)?t.protocol:void 0},t.prototype.isOpen=function(){return this.isState("open")},t.prototype.isActive=function(){return this.isState("open","connecting")},t.prototype.isProtocolSupported=function(){var t;return t=this.getProtocol(),a.call(i,t)>=0},t.prototype.isState=function(){var t,n;return n=1<=arguments.length?r.call(arguments,0):[],t=this.getState(),a.call(n,t)>=0},t.prototype.getState=function(){var t,n,e;for(n in WebSocket)if(e=WebSocket[n],e===(null!=(t=this.webSocket)?t.readyState:void 0))return n.toLowerCase();return null},t.prototype.installEventHandlers=function(){var t,n;for(t in this.events)n=this.events[t].bind(this),this.webSocket["on"+t]=n},t.prototype.uninstallEventHandlers=function(){var t;for(t in this.events)this.webSocket["on"+t]=function(){}},t.prototype.events={message:function(t){var e,o,i,s;if(this.isProtocolSupported())switch(i=JSON.parse(t.data),e=i.identifier,o=i.message,s=i.type,s){case n.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case n.ping:return this.monitor.recordPing();case n.confirmation:return this.subscriptions.notify(e,"connected");case n.rejection:return this.subscriptions.reject(e);default:return this.subscriptions.notify(e,"received",o)}},open:function(){if(ActionCable.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return ActionCable.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(){if(ActionCable.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return ActionCable.log("WebSocket onerror event")}},t}()}.call(this),function(){var t=[].slice;ActionCable.Subscriptions=function(){function n(t){this.consumer=t,this.subscriptions=[]}return n.prototype.create=function(t,n){var e,o,i;return e=t,o="object"==typeof e?e:{channel:e},i=new ActionCable.Subscription(this.consumer,o,n),this.add(i)},n.prototype.add=function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t},n.prototype.remove=function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t},n.prototype.reject=function(t){var n,e,o,i,s;for(o=this.findAll(t),i=[],n=0,e=o.length;n<e;n++)s=o[n],this.forget(s),this.notify(s,"rejected"),i.push(s);return i},n.prototype.forget=function(t){var n;return this.subscriptions=function(){var e,o,i,s;for(i=this.subscriptions,s=[],e=0,o=i.length;e<o;e++)n=i[e],n!==t&&s.push(n);return s}.call(this),t},n.prototype.findAll=function(t){var n,e,o,i,s;for(o=this.subscriptions,i=[],n=0,e=o.length;n<e;n++)s=o[n],s.identifier===t&&i.push(s);return i},n.prototype.reload=function(){var t,n,e,o,i;for(e=this.subscriptions,o=[],t=0,n=e.length;t<n;t++)i=e[t],o.push(this.sendCommand(i,"subscribe"));return o},n.prototype.notifyAll=function(){var n,e,o,i,s,r,c;for(e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],s=this.subscriptions,r=[],o=0,i=s.length;o<i;o++)c=s[o],r.push(this.notify.apply(this,[c,e].concat(t.call(n))));return r},n.prototype.notify=function(){var n,e,o,i,s,r,c;for(r=arguments[0],e=arguments[1],n=3<=arguments.length?t.call(arguments,2):[],c="string"==typeof r?this.findAll(r):[r],s=[],o=0,i=c.length;o<i;o++)r=c[o],s.push("function"==typeof r[e]?r[e].apply(r,n):void 0);return s},n.prototype.sendCommand=function(t,n){var e;return e=t.identifier,this.consumer.send({command:n,identifier:e})},n}()}.call(this),function(){ActionCable.Subscription=function(){function t(t,e,o){this.consumer=t,null==e&&(e={}),this.identifier=JSON.stringify(e),n(this,o)}var n;return t.prototype.perform=function(t,n){return null==n&&(n={}),n.action=t,this.send(n)},t.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},t.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},n=function(t,n){var e,o;if(null!=n)for(e in n)o=n[e],t[e]=o;return t},t}()}.call(this),function(){ActionCable.Consumer=function(){function t(t){this.url=t,this.subscriptions=new ActionCable.Subscriptions(this),this.connection=new ActionCable.Connection(this)}return t.prototype.send=function(t){return this.connection.send(t)},t.prototype.connect=function(){return this.connection.open()},t.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},t.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},t}()}.call(this),function(){this.App||(this.App={}),App.cable=ActionCable.createConsumer()}.call(this),App.game=App.cable.subscriptions.create("GameChannel",{connected:function(){console.log("Channel connected ::> ",this)},disconnected:function(){console.log("Channel disconnected ::> ",this)},received:function(t){void 0!==t.message&&MessageBox.set(this.renderMessage(t.message),"html"),console.log("cabel data is ",t),cb=$("div[plate_code='"+t.state+"']"),"spoil"==t.action?(console.log("bonus?",t.bonus),Plate.turnOff(cb),Plate.enable(cb,t.image),setTimeout(function(){Table.update_points(t.player,t.points)},Tectonic.getTimer())):"clear"==t.action?(Plate.turnOn(cb),Plate.enable(cb),setTimeout(function(){Table.update_points(t.player,t.points)},Tectonic.getTimer())):"lock"==t.action?(Plate.disable(cb),Table.join(t.player)):"join"==t.action},renderMessage:function(t){return t}});